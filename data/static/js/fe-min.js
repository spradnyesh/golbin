$(window).load(function (event) { var subnav = null; var carouselMove = 4; var switchTo5x = true; var createPane = function (id) { $("#bd").append($("<div id=\'" + id + "\'><a class=\'close\' href=\'\'>Close</a><div class=\'message\'></div></div>")); return $("#" + id + " a.close").click(function (event) { return closePane(event); }); }; var closePane = function (event) { if (event) { event.preventDefault(); }; return $("#pane").remove(); }; var ajaxFail = function (jqXHR, textStatus, errorThrown) { if (textStatus === "parseerror") { alert("Received an invalid response from server. Please try again after some time."); } else { alert("Network error"); }; return false; }; var submitFormAjax = function (form) { return $(form).attr("action", "/ajax" + $(form).attr("action")); }; var formSubmit = function (event, form) { if (event) { event.preventDefault(); }; return $(form).ajaxSubmit({ "data-type" : "json", "cache" : false, "async" : false, "success" : function (data, textStatus, jqXHR) { return formSubmitDone(data, textStatus, jqXHR); }, "error" : function (jqXHR, textStatus, errorThrown) { return ajaxFail(jqXHR, textStatus, errorThrown); } }); }; var formSubmitDone = function (data, textStatus, jqXHR) { return data.status === "success" ? (window.location = data.data) : formFail(data); }; var formFail = function (data) { createPane("pane"); $("#pane ul").remove(); $("#pane .message").append($("<p>" + data.message + "</p>")); var errors = "<ul>"; for (var err = null, _js_idx86 = 0; _js_idx86 < data.errors.length; _js_idx86 += 1) { err = data.errors[_js_idx86]; errors = errors + "<li>" + err + "</li>"; }; errors += "</ul>"; return $("#pane .message").append($(errors)); }; var lazyLoadJs = function () { $.getScript("/static/js/jquery-lazyload-ad-1-4-2-min.js", function (data, textStatus, jqxhr) { return $("div.lazyload_ad").lazyLoadAd(); }); return $.getScript("http://s.sharethis.com/loader.js", function (data, textStatus, jqxhr) { return $.getScript("http://w.sharethis.com/button/buttons.js", function (data, textStatus, jqxhr) { stLight.options({ "publisher" : "72b76e38-1974-422a-bd23-e5b0b26b0399", "doNotHash" : false, "doNotCopy" : false, "hashAddressBar" : false }); var options = { "publisher" : "72b76e38-1974-422a-bd23-e5b0b26b0399", "scrollpx" : 50, "ad" : { "visible" : false }, "chicklets" : { "items" : ["facebook", "twitter", "googleplus", "blogger", "orkut", "pinterest", "sharethis", "googleplus", "email"] } }; var st_pulldown_widget = new sharethis.widgets.pulldownbar(options); return null; }); }); }; var updateSubcategory = function (event) { if (event) { event.preventDefault(); }; var node = event.target.parentNode.parentNode; if (node.nodeName === "LI") { subnav = $("#subnav").children(); $("#subnav").empty(); return $("#subnav").append($(event.target.parentNode.parentNode).children("ul").children()); }; }; var restoreSubcategory = function (event) { if (event) { event.preventDefault(); }; var node = event.target.parentNode.parentNode; if (node.nodeName === "LI") { $(node).children("ul").append($("#subnav").children()); $("#subnav").empty(); return $("#subnav").append(subnav); }; }; var commentsFormSubmit = function (event) { $("#challenge td input").val(Recaptcha.get_challenge()); $("#response td input").val(Recaptcha.get_response()); return formSubmit(event, "#comments form"); }; var carouselPrev = function (event) { if (event) { event.preventDefault(); }; var parent = $(event.target.parentNode.parentNode); var prev = parent.children("div.prev"); var current = parent.children("div.current"); var next = parent.children("div.next"); var prevChildren = prev.children(); if (prevChildren.length > 0) { next.append(current.children()); return current.append(prev.children()[prevChildren.length - 1]); }; }; var carouselNext = function (event) { if (event) { event.preventDefault(); }; var parent = $(event.target.parentNode.parentNode); var prev = parent.children("div.prev"); var current = parent.children("div.current"); var next = parent.children("div.next"); var nextChildren = next.children(); var lenNext = nextChildren.length; if (lenNext > 0) { prev.append(current.children()); current.append(nextChildren[0]); if (lenNext === 1) { var id = parent.parent().children("span").html(); var pageTypeof = parent.children("span").html().split(", "); return $.ajax({ "url" : pageTypeof[1].replace(/0\/$/, pageTypeof[0] + "/"), "cache" : false, "async" : false, "data-type" : "json" }).done(function (data) { if (data.status === "success") { parent.children("span").html(1 + parseInt(pageTypeof[0]) + ", " + pageTypeof[1]); return next.append(data.data); } else { return carouselFail(data); }; }).fail(function (data) { return carouselFail(data); }); }; }; }; var carouselFail = function (data) { return null; }; lazyLoadJs(); submitFormAjax("#comments form"); $("#prinav .cat h2 a").hover(function (event) { return updateSubcategory(event); }, function (event) { return restoreSubcategory(event); }); $(".carousel p.prev a").click(function (event) { return carouselPrev(event); }); $(".carousel p.next a").click(function (event) { return carouselNext(event); }); return $("#comments form").submit(function (event) { return commentsFormSubmit(event); }); });
